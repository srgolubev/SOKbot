# Документация этапа 1: Интеграция AI для обработки команд

**Версия:** 1.0  
**Дата:** 25.02.2025  
**Автор:** [Ваше Имя или Команда разработки]

---

## 1. Введение

### Цель
Создать модуль, который будет:
- Принимать команды от пользователей в Telegram;
- Распознавать и извлекать из текста название нового проекта и список разделов;
- Обрабатывать команду даже в случае обнаружения похожих проектов (создавая новый лист независимо от этого);
- Подготавливать данные для последующей интеграции с Google Sheets API (создание нового листа по шаблону).

### Область применения
Данный модуль будет являться первой ступенью в цепочке автоматизации рабочих процессов компании по организации спортивных мероприятий. Он обеспечивает корректное и быстрое распознавание команд, что является основой для дальнейшей автоматизации создания и обновления данных в Google Таблицах.

---

## 2. Функциональные требования

1. **Прием команды:**
   - Бот должен принимать команду вида:
     > “@бот, создай таблицу Фестиваль гто, добавь разделы аренда, судьи, звук, свет, сцена, сувенирка, наградная”

2. **Парсинг команды:**
   - Извлечение названия проекта (например, "Фестиваль гто").
   - Извлечение списка разделов (например, [«аренда», «судьи», «звук», «свет», «сцена», «сувенирка», «наградная»]).
   - Обработка команд с учетом возможных вариаций и ошибок в синтаксисе.

3. **Проверка на похожие проекты (опционально уведомление):**
   - Модуль может осуществлять поиск по существующим проектам для уведомления пользователя о наличии похожих названий, но при этом продолжать создание нового листа.

4. **Интерфейс для передачи данных:**
   - Результат обработки команды должен передаваться в следующий модуль (интеграция с Google Sheets API), который будет создавать новый лист по заданному шаблону.

---

## 3. Нефункциональные требования

- **Точность:** Высокая точность извлечения информации из текстовых команд.
- **Производительность:** Минимальное время обработки команд для обеспечения оперативного взаимодействия.
- **Масштабируемость:** Возможность дальнейшего расширения функционала (например, добавление новых кейсов обработки команд).
- **Надежность:** Обработка ошибок и исключений для предотвращения сбоев работы бота.

---

## 4. Архитектура и компоненты

### Компоненты системы:
1. **Telegram Bot Handler:**  
   - Получает сообщения от пользователей через Telegram Bot API.
   - Перенаправляет входящие команды в модуль обработки.

2. **NLP Parser (Модуль AI):**  
   - Анализирует текст команды.
   - Извлекает ключевые данные (название проекта, список разделов) с использованием технологий обработки естественного языка (NLP).  
   - Для гибкости и точности рекомендуется использовать современные трансформер-модели (например, модели от Hugging Face) или настраивать spaCy с кастомными правилами.

3. **Data Validator (опционально):**  
   - Выполняет проверку на наличие похожих проектов в базе данных.
   - Отправляет уведомление пользователю, если найдены совпадения, без блокировки создания нового листа.

4. **Logging & Error Handling:**  
   - Отслеживание ошибок, логирование событий для упрощения отладки и поддержки.

### Взаимодействие модулей:
1. Пользователь отправляет команду в Telegram.
2. **Telegram Bot Handler** принимает сообщение и передает его в **NLP Parser**.
3. **NLP Parser** извлекает название проекта и список разделов.
4. (При необходимости) **Data Validator** проверяет наличие похожих проектов и уведомляет пользователя.
5. Результаты обработки отправляются в следующий модуль для создания нового листа в Google Таблице.

---

## 5. Технологический стек

- **Язык разработки:** Python 3.8+
- **Библиотеки и фреймворки:**
  - [python-telegram-bot](https://github.com/python-telegram-bot/python-telegram-bot) – для интеграции с Telegram.
  - spaCy или библиотеки на основе трансформеров (Hugging Face Transformers) – для обработки естественного языка и извлечения сущностей.
  - `logging` – для ведения логов и обработки ошибок.
  - unittest/pytest – для юнит-тестирования.

- **Интеграция:**
  - Telegram Bot API – для получения и отправки сообщений.
  - Google Sheets API – подготовка данных для последующей интеграции (создание нового листа).

- **Развертывание:**
  - Локально или на облачной платформе (Heroku, Google App Engine, AWS) для обеспечения доступности сервиса.

---

## 6. Пошаговое руководство по реализации

### Этап 1: Настройка Telegram Bot
- **Регистрация:** Зарегистрировать бота через BotFather и получить API-токен.
- **Базовая конфигурация:** Написать простой скрипт, который получает входящие сообщения.

### Этап 2: Разработка модуля NLP Parser
- **Определение формата команды:** Составить список возможных вариантов команд, учитывая вариации в синтаксисе.
- **Имплементация парсера:**
  - Использовать библиотеки NLP (например, spaCy или Hugging Face Transformers) для извлечения названия проекта и списка разделов.
  - Настроить кастомные правила или дообучить модель на примерах ваших команд.
- **Тестирование:** Написать юнит-тесты для проверки корректности работы парсера на различных примерах команд.

### Этап 3: Интеграция модуля NLP Parser с Telegram Bot Handler
- **Обработка сообщений:** Настроить бота так, чтобы он вызывал функцию парсера при получении сообщения.
- **Ответ пользователю:** При успешном извлечении данных отправлять сообщение с подтверждением (например, “Новый проект 'Фестиваль гто' с разделами: аренда, судьи, ... обработан. Продолжаю создание листа.”).

### Этап 4: Логирование и обработка ошибок
- **Логирование:** Внедрить механизм логирования для отслеживания входящих сообщений и ошибок.
- **Обработка исключений:** Обеспечить корректное поведение бота в случае некорректных команд или ошибок парсинга.

### Этап 5: Подготовка к интеграции с Google Sheets API
- **Интерфейс передачи данных:** Разработать интерфейс (например, функцию), которая принимает результаты работы парсера и передает их в следующий модуль для создания листа.
- **Документация:** Подготовить описание формата данных для передачи, чтобы модуль работы с Google Sheets мог корректно их обработать на следующем этапе.

---

## 7. План тестирования

- **Юнит-тесты для парсера:**
  - Тесты с корректными командами.
  - Тесты с некорректным форматом команд (ожидается корректное сообщение об ошибке).
- **Интеграционные тесты:**
  - Тестирование взаимодействия между Telegram Bot Handler и модулем NLP Parser.
  - Симуляция отправки команд и проверка ответов бота.
- **Логирование и мониторинг:**
  - Проверка корректного логирования всех событий и ошибок.

---

## 8. Документация и комментарии

- **Комментарии в коде:** Обязательно документировать ключевые функции и блоки кода.
- **Пользовательская документация:** Подготовить краткое руководство для внутренних пользователей (сотрудников), описывающее формат команд и примеры использования бота.

---

## 9. Заключение

Первый этап разработки направлен на создание надежного модуля для обработки текстовых команд с использованием технологий обработки естественного языка (NLP). Реализация данного этапа обеспечит фундамент для дальнейшей автоматизации создания новых листов в Google Таблицах и интеграции с другими рабочими процессами.

---

